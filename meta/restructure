#!/usr/bin/env bash

set -e

. "$(dirname -- "$0")/shared.sh"

# We will be renaming algoviz/basics to algoviz/algoviz. Check if that is safe.
[ ! -d algoviz ] || die 'a directory called "algoviz" already exists'
[ ! -e algoviz ] || die 'a non-directory called "algoviz" already exists'

git mv basics/{.flake8,.isort.cfg,.vscode,environment.yml,requirements.txt} .
mkdir notes notebooks tests
git mv basics/{*-notes.txt,*.md} notes/
git mv basics/*.ipynb notebooks/
git mv basics/test_* tests/
git mv basics algoviz
touch algoviz/__init__.py
sed -bri 's/name: algoviz-basics\b/name: algoviz/' environment.yml
git add environment.yml algoviz/__init__.py

"$(dirname -- "$0")/patch-imports"

cat <<EOF
All automated steps appear to have completed successfully.

Large scale changes were staged. Run "git diff --staged" to see them.

Patches to imports were not staged. Run "git diff" to see them.

From this point forward, almost all use of the project should be from the root
of the repository. Editors/IDEs should open that directory. Test runners, style
checkers, and jupyter (including for JupyterLab) should be run from there.

Remember to:

1. Inspect the changes.
2. Create and use the new conda environment.
3. Run all tests. Ensure the pytest, unittest, and doctest test runners work.
4. Stage. Run isort (it will consoldate new "from" imports) and flake8.
5. Manually update, run, and inspect every notebook. Do this carefully.
6. Manually inspect all docstrings and comments, fixing outdated references.
7. Update /README.md. Include how to: open project, run tests, use notebooks.
8. Merge to other branches. Manually check and fix them, even if no conflicts.

To reread this message, look inside the script file: $0
EOF
